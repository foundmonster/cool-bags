<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cool Bags</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', sans-serif;
            background: #ffffff;
            font-weight: 400;
            color: #1d1d1f;
            overflow: hidden;
            height: 100vh;
        }

        /* Main Layout: Sidebar + Grid */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: #fafafa;
            border-right: 1px solid rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 32px 24px 24px;
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 400;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .sidebar-header .subtitle {
            font-size: 12px;
            color: #86868b;
        }

        /* Controls Section */
        .controls-section {
            padding: 24px;
            flex: 1;
            overflow-y: auto;
        }

        .control-group {
            padding: 16px 0;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            font-weight: 400;
            color: #86868b;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group select {
            width: 100%;
            padding: 8px 10px;
            font-size: 13px;
            font-weight: 400;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            font-family: inherit;
            cursor: pointer;
        }

        .control-group select:focus {
            outline: none;
            border-color: rgba(0, 0, 0, 0.3);
        }

        .control-group input[type="range"] {
            width: 100%;
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #1d1d1f;
            border-radius: 50%;
            cursor: pointer;
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #1d1d1f;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Checkbox Controls */
        .checkbox-control {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
            cursor: pointer;
        }

        .checkbox-control input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .checkbox-control span {
            font-size: 13px;
            color: #1d1d1f;
            font-weight: 400;
        }

        /* Radio Controls for Info Scale */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 4px 0;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 4px 0;
        }

        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .radio-option span,
        .checkbox-option label {
            font-size: 12px;
            color: #1d1d1f;
            font-weight: 400;
            line-height: 1.4;
            cursor: pointer;
        }

        /* Divider */
        .divider {
            height: 1px;
            background: rgba(0, 0, 0, 0.06);
            margin: 24px 0;
        }

        /* Drawer/Accordion Controls */
        .drawer {
            margin-bottom: 0;
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            cursor: pointer;
            user-select: none;
        }

        .drawer-header:hover {
            opacity: 0.7;
        }

        .drawer-title {
            font-size: 12px;
            font-weight: 400;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .drawer-arrow {
            font-size: 10px;
            color: #86868b;
            transition: transform 0.2s;
            display: none;
        }

        .drawer.open .drawer-arrow {
            transform: rotate(180deg);
        }

        .drawer-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.15s ease-out;
        }

        .drawer.open .drawer-content {
            max-height: 2000px;
        }

        .drawer-inner {
            padding: 12px 0;
        }

        /* Sidebar Footer */
        .sidebar-footer {
            padding: 24px;
        }

        .sidebar-footer button {
            width: 100%;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 400;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            margin-bottom: 8px;
        }

        .sidebar-footer button:hover {
            background: rgba(0, 0, 0, 0.02);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .sidebar-footer button:active {
            background: rgba(0, 0, 0, 0.04);
        }

        .sidebar-footer button.primary {
            background: #1d1d1f;
            color: white;
            border-color: #1d1d1f;
        }

        .sidebar-footer button.primary:hover {
            background: #3a3a3c;
            border-color: #3a3a3c;
        }

        .sidebar-footer button.primary:active {
            background: #000000;
            border-color: #000000;
        }

        .button-wrapper {
            position: relative;
            margin-bottom: 8px;
        }

        .button-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 5;
            border-radius: 4px;
        }

        .button-wrapper:hover::before {
            opacity: 0.7;
        }

        .coming-soon-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateX(var(--random-offset, 0px)) rotate(var(--random-angle, 0deg));
            font-size: 11px;
            font-weight: 400;
            color: #f56300;
            opacity: 0;
            transition: opacity 0.6s ease;
            pointer-events: none;
            z-index: 10;
        }

        .button-wrapper:hover .coming-soon-label {
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .link-issue-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(var(--random-angle, 0deg));
            font-size: 10px;
            font-weight: 500;
            color: white;
            background: #ff3b30;
            padding: 4px 8px;
            border-radius: 3px;
            pointer-events: none;
            z-index: 10;
            letter-spacing: 0.3px;
        }

        .notifications-button {
            width: 100%;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 400;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            margin-bottom: 0;
            position: relative;
            z-index: 1;
        }

        .notifications-button:hover {
            background: rgba(0, 0, 0, 0.02);
            border-color: rgba(0, 0, 0, 0.2);
            opacity: 0.15;
        }

        .notifications-button:active {
            background: rgba(0, 0, 0, 0.04);
            opacity: 0.15;
        }

        .feedback-button {
            width: 100%;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 400;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            margin-bottom: 8px;
        }

        .feedback-button:hover {
            background: rgba(0, 0, 0, 0.02);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .feedback-button:active {
            background: rgba(0, 0, 0, 0.04);
        }

        .footer-info {
            font-size: 12px;
            color: #86868b;
            text-align: left;
            margin-top: 8px;
            line-height: 1.5;
        }

        /* Coffee Steam Animation */
        .coffee-with-steam {
            position: relative;
            display: inline-block;
        }

        .steam-wave {
            position: absolute;
            bottom: calc(100% + 3px);
            transform: translateX(-50%) rotate(90deg);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 10px;
            line-height: 0;
        }

        .steam-1 {
            left: 55%;
        }

        .steam-2 {
            left: 75%;
        }

        .steam-3 {
            left: 95%;
        }

        .coffee-button:hover .steam-wave {
            opacity: 0.6;
            animation: flip-wave 1s step-end infinite;
        }

        @keyframes flip-wave {
            0%, 49% {
                transform: translateX(-50%) rotate(90deg) scaleX(1);
            }
            50%, 100% {
                transform: translateX(-50%) rotate(90deg) scaleX(-1);
            }
        }

        /* Hamburger Menu Button (Mobile) */
        .menu-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            width: 44px;
            height: 44px;
            padding: 0;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .menu-button span {
            width: 20px;
            height: 2px;
            background: #1d1d1f;
            transition: all 0.3s;
        }

        .menu-button.open span:nth-child(1) {
            transform: translateY(8px) rotate(45deg);
        }

        .menu-button.open span:nth-child(2) {
            opacity: 0;
        }

        .menu-button.open span:nth-child(3) {
            transform: translateY(-8px) rotate(-45deg);
        }

        /* Menu Overlay */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .menu-overlay.visible {
            display: block;
            opacity: 1;
        }

        /* About Link in Sidebar */
        .sidebar-about-link {
            padding: 16px 24px;
            font-size: 13px;
            color: #1d1d1f;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            transition: background 0.2s;
            display: none;
        }

        .sidebar-about-link:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                top: 0;
                right: -100vw;
                width: 100vw;
                height: 100vh;
                z-index: 1000;
                transition: right 0.3s ease;
                box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            }

            .sidebar.open {
                right: 0;
            }

            .menu-button {
                display: flex;
            }

            .floating-about {
                display: none;
            }

            .sidebar-about-link {
                display: block;
            }

            .version {
                display: none;
            }

            .version-mobile {
                display: block;
            }

            .pinned-counter {
                right: 70px;
            }

            .grid-container {
                width: 100%;
            }

            .backpack-grid {
                grid-template-columns: repeat(var(--grid-columns, 2), 1fr);
            }

            .backpack-material {
                display: none;
            }
        }

        /* Version Indicator */
        .version {
            position: fixed;
            bottom: 12px;
            left: 24px;
            font-size: 10px;
            color: #86868b;
            opacity: 0.5;
            z-index: 10;
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        .version-mobile {
            display: none;
            font-size: 10px;
            color: #86868b;
            opacity: 0.5;
            font-weight: 400;
            letter-spacing: 0.3px;
            margin-top: 16px;
            text-align: left;
        }

        /* Floating About Button (Desktop) */
        .floating-about {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 400;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .floating-about:hover {
            color: #86868b;
        }

        /* Pin Button on Hover */
        .pin-button {
            position: absolute;
            top: 18px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 4;
            cursor: pointer;
        }

        .backpack-item:hover .pin-button {
            opacity: 1;
        }

        .pin-dot {
            width: 8px;
            height: 8px;
            background: #1d1d1f;
            border-radius: 50%;
        }

        .pin-label {
            display: none;
            font-size: 10px;
            color: #1d1d1f;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(255, 255, 255, 0.95);
            padding: 4px 8px;
            border-radius: 2px;
            white-space: nowrap;
        }

        .pin-button:hover .pin-label {
            display: block;
        }

        .pin-button.pinned {
            opacity: 1;
        }

        .pin-button.pinned .pin-dot {
            background: white;
            box-shadow: 0 0 0 2px #1d1d1f;
        }

        .pin-button.pinned .pin-label {
            color: white;
            background: #1d1d1f;
        }

        /* Pinned Counter */
        .pinned-counter {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-right: none;
            border-radius: 4px 0 0 4px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 99;
            font-size: 12px;
            color: #1d1d1f;
            display: none;
        }

        .pinned-counter.visible {
            display: block;
        }

        .pinned-counter:hover {
            color: #86868b;
        }

        .pinned-counter-number {
            font-weight: 500;
            margin-right: 4px;
        }

        /* Pinned Modal */
        .pinned-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .pinned-modal.visible {
            display: flex;
        }

        .pinned-modal-content {
            background: white;
            border-radius: 4px;
            width: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        /* About modal: 50% width */
        #about-modal .pinned-modal-content {
            max-width: 500px;
        }

        /* Pinned modal: full width */
        #pinned-modal .pinned-modal-content {
            max-width: 1200px;
        }

        .pinned-modal-header {
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .pinned-modal-title {
            font-size: 20px;
            font-weight: 400;
            color: #1d1d1f;
            flex: 1;
        }

        .pinned-modal-close {
            padding: 8px 16px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .pinned-modal-close:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .pinned-modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .pinned-modal-body p {
            margin-bottom: 24px;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.6;
            color: #86868b;
        }

        .pinned-modal-footer {
            padding: 24px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            align-items: center;
        }

        .pinned-modal-action {
            padding: 8px 16px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            white-space: nowrap;
        }

        .pinned-modal-action:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .share-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #share-button {
            transition: opacity 0.4s ease;
        }

        #share-button.hiding {
            opacity: 0;
        }

        .share-expanded {
            display: flex;
            gap: 8px;
            align-items: center;
            opacity: 0;
            transform: translateX(-10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .share-expanded.showing {
            opacity: 1;
            transform: translateX(0);
        }

        .share-expanded input {
            min-width: 300px;
            padding: 8px 12px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            font-family: inherit;
        }

        .share-copy-btn,
        .share-close-btn {
            padding: 8px 16px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            height: 33px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .share-close-btn {
            width: 33px;
            padding: 0;
            font-size: 18px;
            line-height: 1;
        }

        .share-copy-btn:hover,
        .share-close-btn:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .pinned-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .pinned-item {
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 4px;
            padding: 16px;
            position: relative;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .pinned-item:hover {
            opacity: 0.7;
        }

        .pinned-item-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: #86868b;
            line-height: 0;
            padding: 0;
            background: transparent;
            border: none;
        }

        .pinned-item-remove:hover {
            background: rgba(0, 0, 0, 0.02);
            color: #1d1d1f;
        }

        .pinned-item-brand {
            font-size: 10px;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .pinned-item-name {
            font-size: 13px;
            font-weight: 400;
            color: #1d1d1f;
            margin-bottom: 8px;
        }

        .pinned-item-details {
            font-size: 11px;
            color: #86868b;
            display: flex;
            justify-content: space-between;
        }

        /* Main Grid Area */
        .grid-container {
            height: 100vh;
            overflow-y: auto;
        }

        .backpack-grid {
            display: grid;
            grid-template-columns: repeat(var(--grid-columns, 4), 1fr);
        }

        /* Grid Item - Always Square */
        .backpack-item {
            border-right: 1px solid rgba(0, 0, 0, 0.06);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            padding: 20px;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: opacity 0.2s;
            position: relative;
            overflow: hidden;
            aspect-ratio: 1 / 1;
        }

        .backpack-item:hover {
            opacity: 0.7;
        }

        /* Image Container - Full Background */
        .backpack-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f5f5f7;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            z-index: 1;
        }

        .backpack-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
        }

        .backpack-image .placeholder {
            font-size: 64px;
            opacity: 0.2;
        }

        /* Backpack Info - Always Visible (Default) */
        .backpack-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 2;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .backpack-info-left {
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .backpack-info-right {
            display: flex;
            align-items: baseline;
            gap: 6px;
        }

        .backpack-brand {
            position: absolute;
            top: 16px;
            left: 16px;
            font-size: 11px;
            font-weight: 400;
            color: #1d1d1f;
            line-height: 1.2;
            z-index: 2;
        }

        .backpack-name {
            font-size: 11px;
            font-weight: 400;
            color: #1d1d1f;
            line-height: 1.2;
        }

        .backpack-stats {
            font-size: 11px;
            color: #86868b;
        }

        .backpack-volume {
            color: #86868b;
        }

        .backpack-material {
            font-size: 11px;
            color: #86868b;
        }

        .backpack-price {
            font-size: 11px;
            font-weight: 400;
            color: #1d1d1f;
        }

        /* Empty State */
        .empty-state {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #86868b;
            min-height: 400px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 15px;
            text-align: center;
        }

        /* Feedback Modal Styles */
        .feedback-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .feedback-modal.visible {
            display: flex;
        }

        .feedback-modal-content {
            background: white;
            border-radius: 4px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .feedback-modal-header {
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }

        .feedback-modal-title {
            font-size: 20px;
            font-weight: 400;
            color: #1d1d1f;
        }

        .feedback-modal-close {
            padding: 8px 16px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .feedback-modal-close:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .feedback-modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .feedback-form-group {
            margin-bottom: 20px;
        }

        .feedback-form-group label {
            display: block;
            font-size: 12px;
            font-weight: 400;
            color: #86868b;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feedback-form-group input[type="text"],
        .feedback-form-group input[type="email"],
        .feedback-form-group textarea,
        .feedback-form-group select {
            width: 100%;
            padding: 10px 12px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            font-family: inherit;
        }

        .feedback-form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .feedback-form-group input:focus,
        .feedback-form-group textarea:focus,
        .feedback-form-group select:focus {
            outline: none;
            border-color: rgba(0, 0, 0, 0.3);
        }

        .feedback-form-note {
            font-size: 11px;
            color: #86868b;
            margin-top: 4px;
        }

        .feedback-modal-footer {
            padding: 24px;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            border-top: 1px solid rgba(0, 0, 0, 0.06);
            opacity: 1;
            max-height: 200px;
            overflow: hidden;
            transition: opacity 0.3s ease, max-height 0.4s ease, padding 0.4s ease;
        }

        .feedback-modal-footer button {
            padding: 10px 20px;
            font-size: 13px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .feedback-modal-footer button:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .feedback-modal-footer button.primary {
            background: #1d1d1f;
            color: white;
            border-color: #1d1d1f;
        }

        .feedback-modal-footer button.primary:hover {
            background: #3a3a3c;
        }

        .feedback-modal-footer button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .feedback-success {
            text-align: center;
            padding: 40px 24px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .feedback-success-icon {
            font-size: 48px;
            margin-bottom: 16px;
            display: none;
        }

        .feedback-success-title {
            font-size: 18px;
            font-weight: 400;
            color: #1d1d1f;
            margin-bottom: 12px;
        }

        .feedback-success-message {
            font-size: 13px;
            color: #86868b;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .feedback-success-link {
            display: inline-block;
            padding: 8px 16px;
            font-size: 13px;
            color: #0071e3;
            text-decoration: none;
            border: 1px solid rgba(0, 113, 227, 0.2);
            border-radius: 4px;
            transition: all 0.2s;
        }

        .feedback-success-link:hover {
            background: rgba(0, 113, 227, 0.05);
        }

        /* Type Button Group */
        .feedback-type-group {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .feedback-type-button {
            flex: 1;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 400;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            background: white;
            color: #1d1d1f;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .feedback-type-button:hover {
            background: rgba(0, 0, 0, 0.02);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .feedback-type-button.active {
            background: #1d1d1f;
            color: white;
            border-color: #1d1d1f;
        }
    </style>
</head>
<body>
    <!-- Version Indicator -->
    <div class="version">Last updated Nov.18.25</div>

    <!-- Floating About Button (Desktop) -->
    <button class="floating-about" onclick="openAboutModal()">About</button>

    <!-- Hamburger Menu Button -->
    <button class="menu-button" id="menu-button" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Menu Overlay -->
    <div class="menu-overlay" id="menu-overlay" onclick="closeMenu()"></div>

    <!-- Pinned Counter -->
    <div class="pinned-counter" id="pinned-counter" onclick="openPinnedModal()">
        <span class="pinned-counter-number" id="pinned-count">0</span> pinned
    </div>

    <!-- About Modal -->
    <div class="pinned-modal" id="about-modal" onclick="closeAboutModal(event)">
        <div class="pinned-modal-content" onclick="event.stopPropagation()">
            <div class="pinned-modal-header">
                <h2 class="pinned-modal-title">About Cool Bags</h2>
                <button class="pinned-modal-close" onclick="closeAboutModal()">Close</button>
            </div>
            <div class="pinned-modal-body">
                <p style="margin-bottom: 16px;">Cool Bags is a personal database project, not a shopping site. I've always wanted a comprehensive, well-designed catalog of quality bags and backpacks—something I could browse, compare, and reference. I never found one I liked, so I built it.</p>
                <p style="margin-bottom: 16px;">I'm using AI to help me build this site and extract product data and images from brand websites. It's a slow process—I can only add a few brands at a time, and each one requires careful image processing and data verification.</p>
                <p style="margin-bottom: 16px;">The focus is on bags I think should be listed here.</p>
                <p>This is a side project built for people who have also wanted this kind of website. Submit feedback via the feedback button to get in touch, call out problems, or recommend other brands to be added.</p>
                <p>✌️</p>
            </div>
        </div>
    </div>

    <!-- Pinned Modal -->
    <div class="pinned-modal" id="pinned-modal" onclick="closePinnedModal(event)">
        <div class="pinned-modal-content" onclick="event.stopPropagation()">
            <div class="pinned-modal-header">
                <h2 class="pinned-modal-title">Pinned Bags (<span id="pinned-modal-count">0</span>)</h2>
                <button class="pinned-modal-close" onclick="closePinnedModal()">Close</button>
            </div>
            <div class="pinned-modal-body">
                <div class="pinned-grid" id="pinned-grid">
                    <!-- Pinned items will be populated here -->
                </div>
            </div>
            <div class="pinned-modal-footer">
                <button class="pinned-modal-action" onclick="openAllPinnedLinks()">Open All in New Tabs</button>
                <div class="share-container" id="share-container">
                    <button class="pinned-modal-action" id="share-button" onclick="toggleShareList()">Share List</button>
                    <div class="share-expanded" id="share-expanded" style="display: none;">
                        <input type="text" id="share-url-input" readonly>
                        <button class="share-copy-btn" onclick="copyShareUrl()">Copy</button>
                        <button class="share-close-btn" onclick="closeShareExpanded()">×</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal" onclick="closeFeedbackModal(event)">
        <div class="feedback-modal-content" onclick="event.stopPropagation()">
            <div class="feedback-modal-header">
                <h2 class="feedback-modal-title">Send Feedback</h2>
                <button class="feedback-modal-close" onclick="closeFeedbackModal()">Close</button>
            </div>
            <div class="feedback-modal-body" id="feedback-modal-body">
                <!-- Form View -->
                <form id="feedback-form" style="display: block;">
                    <div class="feedback-type-group">
                        <button type="button" class="feedback-type-button" data-type="bug" onclick="selectFeedbackType('bug')">Bug Report</button>
                        <button type="button" class="feedback-type-button active" data-type="request" onclick="selectFeedbackType('request')">Add Feature</button>
                        <button type="button" class="feedback-type-button" data-type="brand" onclick="selectFeedbackType('brand')">Add Brand</button>
                        <button type="button" class="feedback-type-button" data-type="question" onclick="selectFeedbackType('question')">Question</button>
                    </div>
                    <input type="hidden" id="feedback-type" value="request">

                    <div class="feedback-form-group">
                        <label for="feedback-title">Title</label>
                        <input type="text" id="feedback-title" placeholder="Brief summary..." required>
                    </div>

                    <div class="feedback-form-group">
                        <label for="feedback-description">Description</label>
                        <textarea id="feedback-description" placeholder="Tell us more..." required></textarea>
                    </div>

                    <div class="feedback-form-group">
                        <label for="feedback-email">Email (optional)</label>
                        <input type="email" id="feedback-email" placeholder="your@email.com">
                        <div class="feedback-form-note">We'll notify you when this is resolved</div>
                    </div>
                </form>

                <!-- Success View -->
                <div id="feedback-success" class="feedback-success" style="display: none;">
                    <div class="feedback-success-icon">✅</div>
                    <div class="feedback-success-title">Feedback Submitted!</div>
                    <div class="feedback-success-message">
                        Your feedback has been received and tracked as issue <strong>#<span id="feedback-issue-number"></span></strong>.
                    </div>
                    <a href="#" id="feedback-issue-link" class="feedback-success-link" target="_blank">View on GitHub →</a>
                </div>
            </div>
            <div class="feedback-modal-footer">
                <button type="button" onclick="closeFeedbackModal()">Cancel</button>
                <button type="submit" class="primary" id="feedback-submit" onclick="submitFeedback()">Submit Feedback</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-about-link" onclick="openAboutModal(); closeMenu();">About</div>

            <div class="sidebar-header">
                <h1>Cool Bags</h1>
                <p class="footer-info">Currently displaying <span id="filtered-count">0</span> of <span id="total-count">0</span> bags by&nbsp;<span id="brand-count">0</span>&nbsp;<span id="brand-label">brands</span>.</p>
            </div>

            <div class="controls-section">
                <!-- Sort Drawer -->
                <div class="drawer">
                    <div class="drawer-header" onclick="toggleDrawer(this)">
                        <span class="drawer-title">Sort By</span>
                        <span class="drawer-arrow">▼</span>
                    </div>
                    <div class="drawer-content">
                        <div class="drawer-inner">
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-newest" value="newest" checked>
                                    <span>Newest First</span>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-oldest" value="oldest">
                                    <span>Oldest First</span>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-price-low" value="price-low">
                                    <span>Price: Low to High</span>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-price-high" value="price-high">
                                    <span>Price: High to Low</span>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-size-small" value="size-small">
                                    <span>Size: Small to Large</span>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-size-large" value="size-large">
                                    <span>Size: Large to Small</span>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="sort" id="sort-name" value="name">
                                    <span>Name: A-Z</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter: Brand -->
                <div class="drawer">
                    <div class="drawer-header" onclick="toggleDrawer(this)">
                        <span class="drawer-title">Filter: Brand</span>
                        <span class="drawer-arrow">▼</span>
                    </div>
                    <div class="drawer-content">
                        <div class="drawer-inner">
                            <div class="checkbox-group" id="brand-filter-group">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter: Material -->
                <div class="drawer">
                    <div class="drawer-header" onclick="toggleDrawer(this)">
                        <span class="drawer-title">Filter: Material</span>
                        <span class="drawer-arrow">▼</span>
                    </div>
                    <div class="drawer-content">
                        <div class="drawer-inner">
                            <div class="checkbox-group" id="material-filter-group">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter: Type -->
                <div class="drawer">
                    <div class="drawer-header" onclick="toggleDrawer(this)">
                        <span class="drawer-title">Filter: Type</span>
                        <span class="drawer-arrow">▼</span>
                    </div>
                    <div class="drawer-content">
                        <div class="drawer-inner">
                            <div class="checkbox-group" id="type-filter-group">
                                <!-- Will be populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Zoom Control -->
                <div class="control-group">
                    <label>Bags Per Row</label>
                    <input type="range" id="zoom-select" min="2" max="8" value="4" step="1">
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="brand-tracker-button" onclick="window.location.href='brands.html'">View Progress</button>
                <button class="feedback-button" onclick="openFeedbackModal()">Send Feedback</button>
                <div class="button-wrapper">
                    <span class="coming-soon-label">Coming Soon</span>
                    <button class="notifications-button">Sign Up for Notifications</button>
                </div>
                <button class="primary coffee-button" onclick="window.open('https://buymeacoffee.com/found', '_blank')">
                    <span class="coffee-with-steam">
                        <span class="steam-wave steam-1">∿</span>
                        <span class="steam-wave steam-2">∿</span>
                        <span class="steam-wave steam-3">∿</span>
                        <span class="cup">c[_]</span>
                    </span>
                    Buy Me a Coffee
                </button>
                <div class="version-mobile">Last updated Nov.18.25</div>
            </div>
        </aside>

        <!-- Main Grid -->
        <main class="grid-container">
            <div class="backpack-grid" id="backpack-grid">
                <!-- Items will be generated by JavaScript -->
            </div>
        </main>
    </div>

    <script>
        // Backpack Database - 152 bags across 15+ brands (loaded from bags.json)
        // Bag data loaded from external JSON
        let backpacksData = [];

        // Load bag data from JSON file
        fetch('bags.json')
            .then(response => response.json())
            .then(data => {
                backpacksData = data;
                // Initialize app after data is loaded
                initializeApp();
            })
            .catch(error => {
                console.error('Error loading bag data:', error);
                alert('Failed to load bag database. Please refresh the page.');
            });

        // State
        let selectedBrands = new Set();
        let selectedMaterials = new Set();
        let selectedTypes = new Set();
        let pinnedBags = new Set();

        // Load pinned bags from localStorage on page load
        function loadPinnedFromLocalStorage() {
            const saved = localStorage.getItem('coolbags-pinned');
            if (saved) {
                try {
                    const ids = JSON.parse(saved);
                    const validBagIds = new Set(backpacksData.map(bag => bag.id));
                    // Only keep IDs that exist in current database
                    const validIds = ids.filter(id => validBagIds.has(id));
                    pinnedBags = new Set(validIds);
                    // Save cleaned data back to localStorage
                    if (validIds.length !== ids.length) {
                        savePinnedToLocalStorage();
                    }
                } catch (e) {
                    console.error('Failed to load pinned bags from localStorage', e);
                }
            }
        }

        // Load pinned bags from URL parameter
        function loadPinnedFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('pins')) {
                const ids = urlParams.get('pins').split(',').map(Number).filter(id => !isNaN(id));
                const validBagIds = new Set(backpacksData.map(bag => bag.id));
                // Only keep IDs that exist in current database
                ids.filter(id => validBagIds.has(id)).forEach(id => pinnedBags.add(id));
            }
        }

        // Save pinned bags to localStorage
        function savePinnedToLocalStorage() {
            localStorage.setItem('coolbags-pinned', JSON.stringify(Array.from(pinnedBags)));
        }

        // Get control elements
        const zoomSelect = document.getElementById('zoom-select');
        const backpackGrid = document.getElementById('backpack-grid');
        const filteredCount = document.getElementById('filtered-count');
        const totalCount = document.getElementById('total-count');
        const brandCount = document.getElementById('brand-count');
        const brandLabel = document.getElementById('brand-label');
        const pinnedCounter = document.getElementById('pinned-counter');
        const pinnedCountNum = document.getElementById('pinned-count');
        const pinnedModal = document.getElementById('pinned-modal');
        const pinnedModalCount = document.getElementById('pinned-modal-count');
        const pinnedGrid = document.getElementById('pinned-grid');

        // Pin functions
        function togglePin(bagId, event) {
            event.stopPropagation();

            if (pinnedBags.has(bagId)) {
                pinnedBags.delete(bagId);
            } else {
                pinnedBags.add(bagId);
            }

            savePinnedToLocalStorage();
            updatePinnedUI();
            applyFiltersAndSort(); // Use filtered render instead of renderBackpacks()
        }

        // Open all pinned bag links in new tabs
        function openAllPinnedLinks() {
            const pinnedData = backpacksData.filter(bag => pinnedBags.has(bag.id));

            if (pinnedData.length === 0) {
                alert('No bags pinned yet!');
                return;
            }

            if (pinnedData.length > 10) {
                const userConfirm = window.confirm(`This will open ${pinnedData.length} tabs. Continue?`);
                if (!userConfirm) return;
            }

            pinnedData.forEach(bag => {
                if (bag.link) {
                    window.open(bag.link, '_blank');
                }
            });
        }

        // Share list - toggle expanded view
        function toggleShareList() {
            if (pinnedBags.size === 0) {
                alert('No bags pinned yet!');
                return;
            }

            const shareButton = document.getElementById('share-button');
            const shareExpanded = document.getElementById('share-expanded');
            const shareUrlInput = document.getElementById('share-url-input');

            // Generate shareable URL
            const ids = Array.from(pinnedBags).join(',');
            const url = `${window.location.origin}${window.location.pathname}?pins=${ids}`;

            // Fade out button
            shareButton.classList.add('hiding');

            setTimeout(() => {
                shareButton.style.display = 'none';
                shareExpanded.style.display = 'flex';
                shareUrlInput.value = url;

                // Trigger animation
                setTimeout(() => {
                    shareExpanded.classList.add('showing');
                    shareUrlInput.select();
                    shareUrlInput.focus();
                }, 10);
            }, 400);
        }

        // Copy share URL to clipboard
        function copyShareUrl() {
            const shareUrlInput = document.getElementById('share-url-input');

            navigator.clipboard.writeText(shareUrlInput.value).then(() => {
                // Visual feedback
                const copyBtn = document.querySelector('.share-copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                alert('Failed to copy to clipboard');
            });
        }

        // Close share expanded view
        function closeShareExpanded() {
            const shareButton = document.getElementById('share-button');
            const shareExpanded = document.getElementById('share-expanded');

            // Fade out expanded view
            shareExpanded.classList.remove('showing');

            setTimeout(() => {
                shareExpanded.style.display = 'none';
                shareButton.style.display = 'block';
                shareButton.classList.remove('hiding');
            }, 400);
        }

        function updatePinnedUI() {
            const count = pinnedBags.size;
            pinnedCountNum.textContent = count;
            pinnedModalCount.textContent = count;

            if (count > 0) {
                pinnedCounter.classList.add('visible');
            } else {
                pinnedCounter.classList.remove('visible');
            }

            renderPinnedModal();
        }

        function renderPinnedModal() {
            const pinnedData = backpacksData.filter(bag => pinnedBags.has(bag.id));

            if (pinnedData.length === 0) {
                pinnedGrid.innerHTML = '<p style="color: #86868b; text-align: center; margin: auto;">Pinned bags appear here</p>';
                return;
            }

            pinnedGrid.innerHTML = pinnedData.map(bag => `
                <div class="pinned-item" onclick="openBagLink(${bag.id}, event)">
                    <div class="pinned-item-remove" onclick="togglePin(${bag.id}, event)">×</div>
                    <div class="pinned-item-brand">${bag.brand}</div>
                    <div class="pinned-item-name">${bag.name}</div>
                    <div class="pinned-item-details">
                        <span>${bag.volume}L</span>
                        <span>$${bag.price}</span>
                    </div>
                </div>
            `).join('');
        }

        function openBagLink(bagId, event) {
            // Prevent opening if clicking the remove button
            if (event.target.classList.contains('pinned-item-remove')) {
                return;
            }

            const bag = backpacksData.find(b => b.id === bagId);
            if (bag && bag.link) {
                window.open(bag.link, '_blank');
            } else {
                console.log('Would open link for:', bag ? bag.name : 'Unknown bag');
            }
        }

        function openPinnedModal() {
            pinnedModal.classList.add('visible');
        }

        function closePinnedModal(event) {
            if (event && event.target !== pinnedModal) return;
            pinnedModal.classList.remove('visible');
            // Reset share expanded state
            closeShareExpanded();
        }

        function openAboutModal() {
            document.getElementById('about-modal').classList.add('visible');
        }

        function closeAboutModal(event) {
            const aboutModal = document.getElementById('about-modal');
            if (event && event.target !== aboutModal) return;
            aboutModal.classList.remove('visible');
        }

        // Menu toggle functions
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            const menuButton = document.getElementById('menu-button');
            const overlay = document.getElementById('menu-overlay');

            sidebar.classList.toggle('open');
            menuButton.classList.toggle('open');
            overlay.classList.toggle('visible');
        }

        function closeMenu() {
            const sidebar = document.getElementById('sidebar');
            const menuButton = document.getElementById('menu-button');
            const overlay = document.getElementById('menu-overlay');

            sidebar.classList.remove('open');
            menuButton.classList.remove('open');
            overlay.classList.remove('visible');
        }

        // Drawer toggle function
        function toggleDrawer(header) {
            const drawer = header.parentElement;
            drawer.classList.toggle('open');
        }

        // Initialize filters
        function initializeFilters() {
            // Get unique brands, materials, and types (only from bags that have data)
            const brands = [...new Set(backpacksData.map(b => b.brand))].sort();
            const materials = [...new Set(backpacksData.map(b => b.material).filter(m => m != null))].sort();
            // Only show types that have at least one bag with an image
            const types = [...new Set(backpacksData.filter(b => b.image).map(b => b.type).filter(t => t != null))].sort();

            // Populate brand filter
            const brandGroup = document.getElementById('brand-filter-group');
            brandGroup.innerHTML = brands.map(brand => `
                <div class="checkbox-option">
                    <input type="checkbox" id="brand-${brand.replace(/[^a-z0-9]/gi, '-')}"
                           value="${brand}" onchange="handleBrandFilter(this)">
                    <label for="brand-${brand.replace(/[^a-z0-9]/gi, '-')}">${brand}</label>
                </div>
            `).join('');

            // Populate material filter
            const materialGroup = document.getElementById('material-filter-group');
            materialGroup.innerHTML = materials.map(material => `
                <div class="checkbox-option">
                    <input type="checkbox" id="material-${material.replace(/[^a-z0-9]/gi, '-')}"
                           value="${material}" onchange="handleMaterialFilter(this)">
                    <label for="material-${material.replace(/[^a-z0-9]/gi, '-')}">${material}</label>
                </div>
            `).join('');

            // Populate type filter
            const typeGroup = document.getElementById('type-filter-group');
            typeGroup.innerHTML = types.map(type => `
                <div class="checkbox-option">
                    <input type="checkbox" id="type-${type.replace(/[^a-z0-9]/gi, '-')}"
                           value="${type}" onchange="handleTypeFilter(this)">
                    <label for="type-${type.replace(/[^a-z0-9]/gi, '-')}">${type}</label>
                </div>
            `).join('');
        }

        // Filter handlers
        function handleBrandFilter(checkbox) {
            if (checkbox.checked) {
                selectedBrands.add(checkbox.value);
            } else {
                selectedBrands.delete(checkbox.value);
            }
            applyFiltersAndSort();
        }

        function handleMaterialFilter(checkbox) {
            if (checkbox.checked) {
                selectedMaterials.add(checkbox.value);
            } else {
                selectedMaterials.delete(checkbox.value);
            }
            applyFiltersAndSort();
        }

        function handleTypeFilter(checkbox) {
            if (checkbox.checked) {
                selectedTypes.add(checkbox.value);
            } else {
                selectedTypes.delete(checkbox.value);
            }
            applyFiltersAndSort();
        }

        // Sort handler
        document.querySelectorAll('input[name="sort"]').forEach(radio => {
            radio.addEventListener('change', applyFiltersAndSort);
        });

        // Event listeners
        zoomSelect.addEventListener('input', updateZoom);

        function createBagCard(bag) {
            const isPinned = pinnedBags.has(bag.id);
            const imageHtml = bag.image
                ? `<img src="${bag.image}" alt="${bag.brand} ${bag.name}" loading="lazy" />`
                : `<span class="placeholder">🎒</span>`;

            const zoomLevel = parseInt(zoomSelect.value);
            const isCompact = zoomLevel >= 5;

            // Random angle for link issue label (between -12 and 12 degrees)
            const randomAngle = bag.linkIssue ? Math.floor(Math.random() * 25) - 12 : 0;

            return `
                <div class="backpack-item" data-bag-id="${bag.id}" onclick="window.open('${bag.link}', '_blank')">
                    <div class="backpack-image">
                        ${imageHtml}
                    </div>
                    <div class="pin-button ${isPinned ? 'pinned' : ''}" onclick="togglePin(${bag.id}, event)">
                        <div class="pin-dot"></div>
                        <div class="pin-label">Pin</div>
                    </div>
                    ${bag.linkIssue ? `<div class="link-issue-label" style="--random-angle: ${randomAngle}deg;">LINK ISSUE</div>` : ''}
                    <div class="backpack-brand">${bag.brand}</div>
                    <div class="backpack-info">
                        <div class="backpack-info-left">
                            <div class="backpack-name">${bag.name}</div>
                            ${!isCompact ? `<div class="backpack-stats">
                                <span class="backpack-volume">${bag.volume}L</span>
                            </div>` : ''}
                        </div>
                        <div class="backpack-info-right">
                            ${!isCompact ? `<div class="backpack-material">${bag.material}</div>` : ''}
                            <div class="backpack-price">$${bag.price}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function applyFiltersAndSort() {
            let filteredData = [...backpacksData];

            // Apply brand filter
            if (selectedBrands.size > 0) {
                filteredData = filteredData.filter(bag => selectedBrands.has(bag.brand));
            }

            // Apply material filter
            if (selectedMaterials.size > 0) {
                filteredData = filteredData.filter(bag => selectedMaterials.has(bag.material));
            }

            // Apply type filter
            if (selectedTypes.size > 0) {
                filteredData = filteredData.filter(bag => selectedTypes.has(bag.type));
            }

            // Apply sort
            const sortValue = document.querySelector('input[name="sort"]:checked').value;
            switch(sortValue) {
                case 'price-low':
                    filteredData.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredData.sort((a, b) => b.price - a.price);
                    break;
                case 'size-small':
                    filteredData.sort((a, b) => a.volume - b.volume);
                    break;
                case 'size-large':
                    filteredData.sort((a, b) => b.volume - a.volume);
                    break;
                case 'name':
                    filteredData.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'newest':
                    filteredData.sort((a, b) => b.id - a.id);
                    break;
                case 'oldest':
                    filteredData.sort((a, b) => a.id - b.id);
                    break;
            }

            renderBackpacks(filteredData);
        }

        function updateZoom() {
            const columns = zoomSelect.value;
            document.documentElement.style.setProperty('--grid-columns', columns);
            applyFiltersAndSort(); // Re-render cards to update compact mode
        }

        function renderBackpacks(data = backpacksData) {
            const html = data.map(bag => createBagCard(bag)).join('');
            backpackGrid.innerHTML = html;

            // Update counts
            filteredCount.textContent = data.length;
            totalCount.textContent = backpacksData.length;

            // Calculate unique brands in filtered data
            const uniqueBrands = new Set(data.map(bag => bag.brand));
            const numBrands = uniqueBrands.size;
            brandCount.textContent = numBrands;
            brandLabel.textContent = numBrands === 1 ? 'brand' : 'brands';
        }

        // Randomize "Coming Soon" label position and rotation
        function randomizeComingSoonLabel() {
            const label = document.querySelector('.coming-soon-label');
            if (label) {
                const angle = Math.round((Math.random() * 30 - 15) * 10) / 10; // -15 to 15 degrees in 0.1 increments
                const offsetX = Math.round((Math.random() * 4 - 2) * 10) / 10; // -2 to 2 px in 0.1 increments
                label.style.setProperty('--random-angle', `${angle}deg`);
                label.style.setProperty('--random-offset', `${offsetX}px`);
            }
        }

        // Add hover listener to randomize on each hover
        function initializeComingSoonHover() {
            const buttonWrapper = document.querySelector('.button-wrapper');
            if (buttonWrapper) {
                buttonWrapper.addEventListener('mouseenter', randomizeComingSoonLabel);
            }
        }

        // Initialize app (called after data is loaded)
        function initializeApp() {
            loadPinnedFromLocalStorage();
            loadPinnedFromURL();
            initializeFilters();
            updateSliderRange(); // Set mobile/desktop slider range
            updateZoom();
            applyFiltersAndSort();
            updatePinnedUI();
            initializeComingSoonHover();
            console.log('Cool Bags initialized with', backpacksData.length, 'bags');
        }

        // Update slider range on window resize
        window.addEventListener('resize', updateSliderRange);

        // Function to update slider range based on screen size
        function updateSliderRange() {
            const isMobile = window.innerWidth <= 768;
            const slider = document.getElementById('zoom-select');

            if (isMobile) {
                slider.min = 1;
                slider.max = 3;
                // Constrain current value to mobile range
                if (parseInt(slider.value) > 3) {
                    slider.value = 3;
                    updateZoom();
                }
            } else {
                slider.min = 2;
                slider.max = 8;
                // Set default desktop value if coming from mobile
                if (parseInt(slider.value) < 2) {
                    slider.value = 4;
                    updateZoom();
                }
            }
        }

        // Feedback Modal Functions
        function openFeedbackModal() {
            document.getElementById('feedback-modal').classList.add('visible');
            // Reset form
            document.getElementById('feedback-form').reset();
            document.getElementById('feedback-form').style.display = 'block';
            document.getElementById('feedback-success').style.display = 'none';
            document.getElementById('feedback-submit').disabled = false;
            // Reset type to default (Feature Request)
            selectFeedbackType('request');
        }

        function selectFeedbackType(type) {
            // Remove active class from all buttons
            document.querySelectorAll('.feedback-type-button').forEach(btn => {
                btn.classList.remove('active');
            });
            // Add active class to selected button
            document.querySelector(`.feedback-type-button[data-type="${type}"]`).classList.add('active');
            // Update hidden input
            document.getElementById('feedback-type').value = type;
        }

        function closeFeedbackModal(event) {
            const modal = document.getElementById('feedback-modal');
            if (event && event.target !== modal) return;
            modal.classList.remove('visible');
        }

        async function submitFeedback() {
            const submitButton = document.getElementById('feedback-submit');
            const cancelButton = document.querySelector('#feedback-modal .feedback-modal-footer button[type="button"]');
            const form = document.getElementById('feedback-form');
            const successView = document.getElementById('feedback-success');
            const footer = document.querySelector('#feedback-modal .feedback-modal-footer');
            const type = document.getElementById('feedback-type').value;
            const title = document.getElementById('feedback-title').value.trim();
            const description = document.getElementById('feedback-description').value.trim();
            const email = document.getElementById('feedback-email').value.trim();

            // Validation
            if (!title || !description) {
                alert('Please fill in all required fields');
                return;
            }

            // Disable all inputs and buttons
            const inputs = form.querySelectorAll('input, textarea, button');
            inputs.forEach(input => input.disabled = true);
            submitButton.disabled = true;
            cancelButton.disabled = true;

            // Start animated loading state
            let dotCount = 0;
            submitButton.textContent = 'Submitting';
            const loadingInterval = setInterval(() => {
                dotCount = (dotCount + 1) % 4;
                submitButton.textContent = 'Submitting' + '.'.repeat(dotCount);
            }, 500);

            try {
                // Get browser and page info
                const browser = navigator.userAgent;
                const url = window.location.href;

                // Map type to label
                const labelMap = {
                    'bug': 'bug',
                    'request': 'request',
                    'brand': 'request',
                    'question': 'question'
                };

                // Call Netlify Function
                const response = await fetch('/.netlify/functions/create-issue', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: type,
                        title: title,
                        description: description,
                        email: email || null,
                        label: labelMap[type],
                        browser: browser,
                        url: url
                    })
                });

                const result = await response.json();

                // Stop loading animation
                clearInterval(loadingInterval);

                if (result.success) {
                    // Fade out form
                    form.style.opacity = '0';
                    form.style.transform = 'translateY(-10px)';
                    form.style.transition = 'opacity 0.3s ease, transform 0.3s ease';

                    // Fade out footer
                    footer.style.opacity = '0';
                    footer.style.maxHeight = '0';
                    footer.style.paddingTop = '0';
                    footer.style.paddingBottom = '0';

                    setTimeout(() => {
                        // Hide form, show success
                        form.style.display = 'none';
                        successView.style.display = 'block';
                        document.getElementById('feedback-issue-number').textContent = result.issueNumber;
                        document.getElementById('feedback-issue-link').href = result.issueUrl;

                        // Trigger fade in
                        setTimeout(() => {
                            successView.style.opacity = '1';
                            successView.style.transform = 'translateY(0)';
                        }, 10);
                    }, 300);
                } else {
                    throw new Error(result.error || 'Failed to submit feedback');
                }
            } catch (error) {
                clearInterval(loadingInterval);
                console.error('Feedback submission error:', error);
                alert('Failed to submit feedback. Please try again or contact us directly at GitHub.');
                submitButton.disabled = false;
                cancelButton.disabled = false;
                submitButton.textContent = 'Submit Feedback';
                inputs.forEach(input => input.disabled = false);
            }
        }
    </script>
</body>
</html>
